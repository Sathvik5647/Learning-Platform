{% extends "base.html" %}

{% block title %}Add Question - Admin{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <h1 class="display-4"><i class="fas fa-plus-circle me-3"></i>Add New Question</h1>
                <p class="lead">Expand the question bank with quality content</p>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(45deg, #007bff, #6610f2);">
                    <h4 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>Question Details
                    </h4>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        
                        <!-- Question Text -->
                        <div class="mb-4">
                            <label for="text" class="form-label">
                                <i class="fas fa-question-circle me-2 text-primary"></i>Question Text
                            </label>
                            <textarea class="form-control" id="text" name="text" rows="3" 
                                    placeholder="Enter the question text..." required></textarea>
                            <div class="form-text">Write a clear and concise question.</div>
                        </div>

                        <!-- Answer -->
                        <div class="mb-4">
                            <label for="answer" class="form-label">
                                <i class="fas fa-check-circle me-2 text-success"></i>Correct Answer
                            </label>
                            <input type="text" class="form-control" id="answer" name="answer" 
                                   placeholder="Enter the correct answer..." required>
                            <div class="form-text">This should match exactly with one of the options below.</div>
                        </div>

                        <!-- Options -->
                        <div class="mb-4">
                            <label for="options" class="form-label">
                                <i class="fas fa-list me-2 text-info"></i>Answer Options
                            </label>
                            <input type="text" class="form-control" id="options" name="options" 
                                   placeholder="Option1,Option2,Option3,Option4">
                            <div class="form-text">Separate multiple options with commas. Leave empty for text-based questions.</div>
                            <div class="mt-2">
                                <small class="text-muted">
                                    <strong>Example:</strong> Paris,London,Berlin,Madrid
                                </small>
                            </div>
                        </div>

                        <!-- Topic Selection -->
                        <div class="mb-4">
                            <label for="topic_id" class="form-label">
                                <i class="fas fa-tags me-2 text-warning"></i>Topic
                            </label>
                            <select class="form-select" id="topic_id" name="topic_id" required>
                                <option value="">Choose a topic...</option>
                                {% for topic in topics %}
                                    <option value="{{ topic.id }}">{{ topic.name }} - {{ topic.description }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Difficulty Level -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-signal me-2 text-danger"></i>Difficulty Level
                            </label>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="difficulty" id="easy" value="1" required>
                                        <label class="form-check-label" for="easy">
                                            <span class="badge bg-success me-2">Easy</span>
                                            <small class="text-muted">10 points</small>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="difficulty" id="medium" value="2" required>
                                        <label class="form-check-label" for="medium">
                                            <span class="badge bg-warning me-2">Medium</span>
                                            <small class="text-muted">20 points</small>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="difficulty" id="hard" value="3" required>
                                        <label class="form-check-label" for="hard">
                                            <span class="badge bg-danger me-2">Hard</span>
                                            <small class="text-muted">30 points</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Preview Section -->
                        <div class="card bg-light mb-4">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-eye me-2"></i>Question Preview</h6>
                            </div>
                            <div class="card-body">
                                <div id="question-preview">
                                    <p class="text-muted">Fill in the fields above to see a preview of your question.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary me-md-2">
                                <i class="fas fa-times me-1"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Add Question
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tips Card -->
            <div class="card mt-4 border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Question Writing Tips</h5>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li><strong>Be Clear:</strong> Write questions that are easy to understand and unambiguous.</li>
                        <li><strong>Single Focus:</strong> Each question should test one specific concept or skill.</li>
                        <li><strong>Accurate Answers:</strong> Ensure the correct answer exactly matches one of the provided options.</li>
                        <li><strong>Balanced Options:</strong> For multiple choice questions, make all options plausible but only one correct.</li>
                        <li><strong>Appropriate Difficulty:</strong> Choose the difficulty level that matches the complexity of the question.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Question Preview Functionality
document.addEventListener('DOMContentLoaded', function() {
    const textInput = document.getElementById('text');
    const answerInput = document.getElementById('answer');
    const optionsInput = document.getElementById('options');
    const difficultyInputs = document.querySelectorAll('input[name="difficulty"]');
    const preview = document.getElementById('question-preview');

    function updatePreview() {
        const questionText = textInput.value.trim();
        const correctAnswer = answerInput.value.trim();
        const options = optionsInput.value.trim();
        const difficulty = document.querySelector('input[name="difficulty"]:checked');

        if (!questionText) {
            preview.innerHTML = '<p class="text-muted">Fill in the fields above to see a preview of your question.</p>';
            return;
        }

        let html = `<h6>${questionText}</h6>`;
        
        if (options) {
            const optionList = options.split(',').map(opt => opt.trim()).filter(opt => opt);
            if (optionList.length > 0) {
                html += '<div class="mt-3">';
                optionList.forEach((option, index) => {
                    const isCorrect = option === correctAnswer;
                    html += `
                        <div class="form-check">
                            <input class="form-check-input" type="radio" disabled ${isCorrect ? 'checked' : ''}>
                            <label class="form-check-label ${isCorrect ? 'text-success fw-bold' : ''}">
                                ${option} ${isCorrect ? '<i class="fas fa-check text-success"></i>' : ''}
                            </label>
                        </div>
                    `;
                });
                html += '</div>';
            }
        } else if (correctAnswer) {
            html += `<div class="mt-2"><small class="text-success"><strong>Answer:</strong> ${correctAnswer}</small></div>`;
        }

        if (difficulty) {
            const difficultyLabels = { '1': 'Easy', '2': 'Medium', '3': 'Hard' };
            const difficultyColors = { '1': 'success', '2': 'warning', '3': 'danger' };
            const points = parseInt(difficulty.value) * 10;
            html += `<div class="mt-2">
                        <span class="badge bg-${difficultyColors[difficulty.value]}">${difficultyLabels[difficulty.value]}</span>
                        <small class="text-muted ms-2">${points} points</small>
                     </div>`;
        }

        preview.innerHTML = html;
    }

    // Add event listeners
    textInput.addEventListener('input', updatePreview);
    answerInput.addEventListener('input', updatePreview);
    optionsInput.addEventListener('input', updatePreview);
    difficultyInputs.forEach(input => input.addEventListener('change', updatePreview));
});
</script>
{% endblock %}